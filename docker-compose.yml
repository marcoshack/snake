services:
  snake:
    image: ghcr.io/marcoshack/snake:latest
    container_name: snake
    environment:
      # Force Python to run in unbuffered mode for immediate log output
      PYTHONUNBUFFERED: 1

      # Anthropic API key for accessing Claude models
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}

      # OpenSearch connection for fetching Rust server logs
      OPENSEARCH_HOST: ${OPENSEARCH_HOST}
      OPENSEARCH_PORT: ${OPENSEARCH_PORT:-9200}
      OPENSEARCH_USER: ${OPENSEARCH_USER}
      OPENSEARCH_PASSWORD: ${OPENSEARCH_PASSWORD}
      OPENSEARCH_INDEX: ${OPENSEARCH_INDEX}
      OPENSEARCH_RESULT_SIZE: ${OPENSEARCH_RESULT_SIZE:-10000}

      # Discord webhook for posting admin alerts
      DISCORD_RUST_ADMIN_WEBHOOK: ${DISCORD_RUST_ADMIN_WEBHOOK}

      # Override paths to container paths (agent reads these inside container)
      REPORT_OUTPUT_DIR: /app/reports
      LOG_DIR: /app/logs

      # How often to run the analysis
      ANALYSIS_FREQUENCY: ${ANALYSIS_FREQUENCY:-24h}

    volumes:
      # Mount host directories (from .env) to container paths
      - ${REPORT_OUTPUT_DIR:-./reports}:/app/reports
      - ${LOG_DIR:-./logs}:/app/logs

    restart: unless-stopped
